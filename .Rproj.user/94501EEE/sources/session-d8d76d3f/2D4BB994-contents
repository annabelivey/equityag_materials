---
title: "Ivey_L1"
output: html_document
date: "2025-07-14"
---

# load packageS
library(arrow)
library(dplyr)
library(ggplot2)

# load data
merged_data <-read_parquet(file = "merged_data.parquet", stringsAsFactors = TRUE)

#show first few rows and columns of data 
head(merged_data[, 1:10], 6)

#show the last 6 rows, 10 first columns
tail(merged_data[, 1:10], 6)

#show structure and variable types, 10 first columns 
str(merged_data[, 1:10])

# Cleaning data and dropping rows with NA 
merged_data <- na.omit(merged_data)

#getting all data back 
merged_data <- read_parquet(file = "merged_data.parquet", stringsAsFactors = TRUE)

# Subsetting the data to only get AZ data (This does not change the original data; it creates a new object with just AZ data)
subset_data_az <- subset(merged_data, STATE_ABBR_2010SVI == "AZ")

#Summarizing data to get min, max, median, mean etc.
summary(subset_data_az[, 1:10], 6)

#Calculate SD to determine variability of the data 
upward_mean_2010_az <- mean(subset_data_az$upward_mobility_rate_2010)
upward_sd_2010_az <- sd(subset_data_az$upward_mobility_rate_2010)
upward_mean_2020_az <- mean(subset_data_az$upward_mobility_rate_2020)
upward_sd_2020_az <- sd(subset_data_az$upward_mobility_rate_2020)

#Print to display values in the console rather than just the environment 
print(upward_mean_2010_az)

#other ways to print (AZ2010 mean)
print(upward_mean_2010_az <- mean(subset_data_az$upward_mobility_rate_2010))

#printing the AZ SD for 2010
print(upward_sd_2010_az <- sd(subset_data_az$upward_mobility_rate_2010))

#mean for AZ 2020
print(upward_mean_2020_az <- mean(subset_data_az$upward_mobility_rate_2020))

#sd for AZ 2020
print(upward_sd_2020_az <- sd(subset_data_az$upward_mobility_rate_2020))

#subsetting for CA 
subset_data_ca <- subset(merged_data, STATE_ABBR_2010SVI == "CA")

#printing CA mean 2010
print(upward_mean_2010_ca <- mean(subset_data_ca$upward_mobility_rate_2010))

#printing CA sd 2010
print(upward_sd_2010_ca <- sd(subset_data_ca$upward_mobility_rate_2010))

#printing CA mean 2020
print(upward_mean_2020_ca <- mean(subset_data_ca$upward_mobility_rate_2020))

#printing CA sd 2020
print(upward_sd_2020_ca <- sd(subset_data_ca$upward_mobility_rate_2020))

#calculating and printing mean for Pima County 2010
print(pima_upward_mean_2010_az <- mean(subset_data_az$upward_mobility_rate_2010[subset_data_az$COUNTY_2010SVI == "Pima County"]))

#calculating and printing sd for Pima County 2010
print(pima_upward_sd_2010_az <- sd(subset_data_az$upward_mobility_rate_2010[subset_data_az$COUNTY_2010SVI == "Pima County"]))

#calculating and printing mean for Del Norte County 2010
print(delnorte_upward_mean_2010_ca <- mean(subset_data_ca$upward_mobility_rate_2010[subset_data_ca$COUNTY_2010SVI == "Del Norte County"]))

#calculating and printing sd for Del Norte County 2010 
print(delnorte_upward_sd_2010_ca <- sd(subset_data_ca$upward_mobility_rate_2010[subset_data_ca$COUNTY_2010SVI == "Del Norte County"]))

#installing dplyr to avoid tediousness of above process 
install.packages("dplyr")
library(dplyr)

#summarize upward mobility by county in AZ 
summary_stats_upward_2010 <- subset_data_az %>%
  group_by(COUNTY_2010SVI) %>%
  summarize(mean_mobility_2010_az = mean(upward_mobility_rate_2010),
            sd_mobility_2010_az = sd(upward_mobility_rate_2010))

#view the results of the above action 

#installing ggplot
install.packages("ggplot2")

#loading ggplot
library(ggplot2)

#creating a boxplot
mobility_plot <- ggplot(data = summary_stats_upward_2010,
                        mapping = aes(x= COUNTY_2010SVI, y=mean_mobility_2010_az)) +
  geom_boxplot()
print(mobility_plot)

#summarizing every county in every state 
summary_stats_upward_2010_all <- merged_data %>%
  group_by(STATE_ABBR_2010SVI, COUNTY_2010SVI) %>%
  summarize(mean_mobility_2010 = mean(upward_mobility_rate_2010),
            sd_mobility_2010 = sd(upward_mobility_rate_2010))
            
#creating a boxplot grouped by state 
mobility_plot <- ggplot(data = summary_stats_upward_2010_all,
                        mapping = aes(x = STATE_ABBR_2010SVI, y = mean_mobility_2010)) +
  geom_boxplot()
print(mobility_plot)

#removing missing states 
summary_stats_upward_2010_all <- summary_stats_upward_2010_all[!is.na(summary_stats_upward_2010_all$STATE_ABBR_2010SVI),]

#creating boxplot grouped by states 
mobility_plot <- ggplot(data = summary_stats_upward_2010_all,
                        mapping = aes(x= STATE_ABBR_2010SVI, y=mean_mobility_2010,
                                      fill = STATE_ABBR_2010SVI)) +
  geom_boxplot()
print(mobility_plot)

#saving the plot 
ggsave(plot = mobility_plot, filename = "output/mobility-plot-2010.pdf")


#STUDENT ACTIVITY 1

#Chosen county: Orange County 

#calculating and printing mean for Orange County 2010
print(orange_upward_mean_2010_ca <- mean(subset_data_ca$upward_mobility_rate_2010[subset_data_ca$COUNTY_2010SVI == "Orange County"]))

#calculating and printing sd for Orange County 2010
print(orange_upward_sd_2010_ca <- sd(subset_data_ca$upward_mobility_rate_2010[subset_data_ca$COUNTY_2010SVI == "Orange County"])) 


#calculating and printing mean for Orange County 2020
print(orange_upward_mean_2020_ca <- mean(subset_data_ca$upward_mobility_rate_2020[subset_data_ca$COUNTY_2010SVI == "Orange County"]))

#calculating and printing sd for Orange County 2020
print(orange_upward_sd_2020_ca <- sd(subset_data_ca$upward_mobility_rate_2020[subset_data_ca$COUNTY_2010SVI == "Orange County"]))

#Orange county comparison to 2010 California averages:

#Orange county mean (0.8795) is lesser than  than California mean (0.8981)

#Orange county sd (1.2160) is greater than California sd (1.0682)



#Orange County Comparison to 2020 California averages 

#Orange county mean (0.8794) is lesser than California mean (0.8980)
#Orange county sd (1.2156) is greater than California sd (1.0675)

#STUDENT ACTIVITY 2 
#creating a boxplot for Orange County 2010 data 

#creating a subset of data for only Orange County 
subset_data_oc <- subset(merged_data, COUNTY_2010SVI == "Orange County")

#summarizing the data 
summary(subset_data_oc[, 1:10], 6)

#making the 2010 boxplot
plot_oc_2010 <- ggplot(data = subset_data_oc, mapping =aes(y=upward_mobility_rate_2010)) + geom_boxplot() 
print(plot_oc_2010) 
          
#making the 2020 boxplot
plot_oc_2020 <- ggplot(data = subset_data_oc, mapping =aes(y=upward_mobility_rate_2020)) + geom_boxplot() 
print(plot_oc_2020)

#comparison between two years 
#The two years appear the same in both box plots

#outliers 
#There are outliers in both data sets at approximately 17.5


#saving the plots 
ggsave(plot = plot_oc_2010, filename = "output/mobility-oc-2010.pdf")

ggsave(plot = plot_oc_2020, filename = "output/mobility-oc-2020.pdf")


#STUDENT ACTIVITY 3

filtered_data <- filter(subset_data_az,upward_mobility_rate_2010>1)
filtered_data <- subset_data_az 

#How many rows meet that condition?
#363 rows meet that condition
#Patterns in counties 
#I observe no patterns in the counties, but the most common #counties were Apache, Cochise, and Maricopa. 

#REFLECTION
#A question I would have included in this exercise would have been do hotter counties have lower mobility? 
#A question I have after this assignment is what the box plots #should have looked like in question two because I do not feel #confident about my answers. 

